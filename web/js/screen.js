// Generated by CoffeeScript 1.6.1
(function() {
  var traverseTOC;

  $(function() {
    var caption, figure, heading, img, imgs, index, li, next, toc, _i, _j, _len, _len1;
    $('#decayingshelters').nextUntil('#danksagung').remove();
    $('#decayingshelters').after('<iframe src="http://player.vimeo.com/video/63610774" width="100%" height="340" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>');
    $('#hinweis').nextUntil('#inhaltsverzeichnis').remove();
    $('#hinweis').remove();
    $('#eidesstattlicheerklrung').nextUntil('.footnotes').remove();
    $('#eidesstattlicheerklrung').remove();
    imgs = $('img');
    for (_i = 0, _len = imgs.length; _i < _len; _i++) {
      img = imgs[_i];
      img = $(img);
      figure = (img.wrap('<figure></figure>')).parent();
      caption = $('<figcaption></figcaption>');
      caption.html(img.attr('title'));
      figure.append(caption);
    }
    index = $('#inhaltsverzeichnis');
    toc = $('<ol id="toc"></ol>');
    index.after(toc);
    next = index.nextAll('h2');
    for (_j = 0, _len1 = next.length; _j < _len1; _j++) {
      heading = next[_j];
      $(heading).prev('p').addClass('last-p');
      if (heading.id === 'eidesstattlicheerklrung') {
        continue;
      }
      li = $('<li><a href="#' + heading.id + '">' + heading.innerHTML + '</a></li>');
      toc.append(li);
      traverseTOC(heading, li);
    }
  });

  traverseTOC = function(start, parent) {
    var heading, li, next, ol, order, _i, _len;
    if (order > 5) {
      return;
    }
    ol = $('<ol></ol>');
    order = parseInt(start.tagName.split('').pop(), 10);
    order = 'h' + (order + 1);
    next = ($(start)).nextUntil(start.tagName, order);
    for (_i = 0, _len = next.length; _i < _len; _i++) {
      heading = next[_i];
      if (next.tagName === !order) {
        continue;
      }
      li = $('<li><a href="#' + heading.id + '">' + heading.innerHTML + '</a></li>');
      ol.append(li);
      traverseTOC(heading, li);
    }
    if (ol.children().length > 0) {
      parent.append(ol);
    }
  };

}).call(this);
